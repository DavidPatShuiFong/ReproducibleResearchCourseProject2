---
title: "Reproducible Research: Peer Assessment 2"
output: 
  html_document:
    keep_md: true
---

## Project

Goal - To explore the NOAA Storm Database regarding severe weather events.

1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?
2. Across the United States, which types of events have the greatest economic consequences?

The data for this assignment is Storm Data from the National Weather Service. Documentation for the data can be found at the [National Weather Service](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf) and [National Climatic Data Center Storm Events FAQ](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf)

## Data Processing

``` {r results='hide', message=FALSE, warning=FALSE}
### start necessary libraries
library(tidyverse)
library(dplyr)
library(ggplot2)

### set figure save path to figure/
knitr::opts_chunk$set(fig.path = 'figure/')

```

## Download data

Data comes in the form of a comma-separated-value file compressed via the bzip2 algorithm.

``` {r cache=TRUE}
### download data ZIP file if necessary, and extract if necessary
if (!file.exists('StormData.csv.bz2')) {
  if (download.file('https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2','StormData.csv.bz2')) {
    stop('Unable to download data file')
  }
}

StormData <- as.tibble(read.csv(bzfile('StormData.csv.bz2')))

```

Variables of interest

Variable    | Description                 
------------|-----------------------------
BGN_DATE    | date of event starting
BGN_TIME    | time of event starting
TIME_ZONE   | time zone of event
COUNTYNAME  | name of county
STATE       | state of the United STates
EVTYPE      | type of event
FATALITIES  | number of fatalities        
INJURIES    | number of injuries
PROPDMG     | value of property damage in dollars
PROPDMGEXP  | property damage dollar multiplier (K thousands, M millions, B billions)
CROPDMG     | value of crop damage in dollars
CROPDMGEXP  | crop damage dollar multiplier (K thousands, M millions, B billions)
REFNUM      | unique reference number for event


``` {r}
print(unique(StormData$TIME_ZONE))
```
``` {r}

### some timezone names use 'lower-case' characters, convert all to upper-case
StormData$TIME_ZONE <- as.factor(toupper(StormData$TIME_ZONE))

```

```{r}
print(StormData[StormData$TIME_ZONE == 'UNK', c('COUNTYNAME','STATE','REFNUM')])
```
``` {r}
### replace missing timezones

### Oconee County, Georgia
StormData[REFNUM == 23087,]$TIME_ZONE <- 'EST'
### Hawaii country, Hawaii
StormData[REFNUM == 27702,]$TIME_ZONE <- 'HST'
### Coles county, Illinois
StormData[REFNUM == 30669,]$TIME_ZONE <- 'CST'


```

``` {r}
timezones <- c(-3,-9,-4,-5,-9,-5,-6)
names(timezones) <- c('ADT','AKS','AST','CDT','HST','EST','CST')
```

``` {r}

StormData$BEGIN_TIME <- strptime(paste(sub(' .*','',StormData$BGN_DATE),
                                       StormData$BGN_TIME),'%m/%d/%Y %H%M')

```